parameters:
    configured_pipelines:
          processFormPipe: 'RiftRunBundle\CommandBus\Pipelines\ProcessFormPipe'
          transformDTOPipe: 'RiftRunBundle\CommandBus\Pipelines\TransformDTOPipe'
          fetchPipeline:  'RiftRunBundle\Services\Pipelines\FetchPipeline'

services:
    pagerfanta_factory_library:
        class: Hateoas\Representation\Factory\PagerfantaFactory

    pagerfanta_factory:
        class: RiftRunBundle\Factories\PagerfantaFactory

    league_pipeline_builder:
        class: League\Pipeline\PipelineBuilder

    pipeline_manager:
        class: RiftRunBundle\CommandBus\Pipelines\PipelineManager
        arguments:
            - '@league_pipeline_builder'
            - '%configured_pipelines%'
        calls:
            - [ setContainer, [ '@service_container' ] ]

    create_post_command_handler:
        class: RiftRunBundle\CommandBus\Handlers\CreatePostCommandHandler
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@pipeline_manager'
        tags:
            - { name: tactician.handler, command: RiftRunBundle\CommandBus\Commands\CreatePost }

    paginate_posts_command_handler:
        class: RiftRunBundle\CommandBus\Handlers\PaginatePostsCommandHandler
        arguments:
            - '@doctrine'
            - '@pagerfanta_factory'
        tags:
            - { name: tactician.handler, command: RiftRunBundle\CommandBus\Commands\PagerfantaPaginate }

    fetch_single_command_handler:
        class: RiftRunBundle\CommandBus\Handlers\FetchSingleCommandHandler
        arguments:
            - '@doctrine'
        tags:
            - { name: tactician.handler, command: RiftRunBundle\CommandBus\Commands\FetchSingle }

    # QueryBuilder Specification
    all_posts_specification:
        class: RiftRunBundle\ORM\Specification\AllPostsSpecification

    # Query Services
    fetch_posts_service:
        class: RiftRunBundle\Services\PostsQueryService
        arguments:
            - '@pipeline_manager'
            - '@doctrine'
            - '@jms_serializer'

    # Helper
    form_errors_helper:
        class: RiftRunBundle\Helpers\FormErrors